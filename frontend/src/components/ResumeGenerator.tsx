import { useState } from 'react'

interface FormData {
  name: string
  title: string
  email: string
  phone: string
  location: string
  experience: string
  education: string
  skills: string
  summary: string
}

const templates = [
  { id: 'modern', name: 'ç°ä»£ç®€çº¦', color: 'blue' },
  { id: 'professional', name: 'ä¸“ä¸šç»å…¸', color: 'gray' },
  { id: 'creative', name: 'åˆ›æ„è®¾è®¡', color: 'purple' },
  { id: 'tech', name: 'ç§‘æŠ€æå®¢', color: 'green' },
]

function ResumeGenerator() {
  const [formData, setFormData] = useState<FormData>({
    name: '',
    title: '',
    email: '',
    phone: '',
    location: '',
    experience: '',
    education: '',
    skills: '',
    summary: '',
  })
  const [selectedTemplate, setSelectedTemplate] = useState('modern')
  const [generatedResume, setGeneratedResume] = useState('')
  const [loading, setLoading] = useState(false)

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {
    setFormData({ ...formData, [e.target.name]: e.target.value })
  }

  const handleGenerate = () => {
    if (!formData.name || !formData.experience) {
      alert('è¯·å¡«å†™å§“åå’Œå·¥ä½œç»éªŒ')
      return
    }

    setLoading(true)

    // æ¨¡æ‹Ÿ AI ç”Ÿæˆç®€å†
    setTimeout(() => {
      const resume = generateResumeFromTemplate(formData, selectedTemplate)
      setGeneratedResume(resume)
      setLoading(false)
    }, 2000)
  }

  const generateResumeFromTemplate = (data: FormData, template: string) => {
    const skills = data.skills.split(',').map(s => s.trim()).filter(s => s)

    if (template === 'modern') {
      return `
# ${data.name}
**${data.title || 'é«˜çº§å·¥ç¨‹å¸ˆ'}**

ğŸ“§ ${data.email} | ğŸ“± ${data.phone} | ğŸ“ ${data.location}

---

## ğŸ’¡ ä¸ªäººç®€ä»‹

${data.summary || 'å¯Œæœ‰ç»éªŒçš„å·¥ç¨‹å¸ˆï¼Œä¸“æ³¨äºæŠ€æœ¯åˆ›æ–°å’Œå›¢é˜Ÿåä½œã€‚'}

---

## ğŸ› ï¸ æ ¸å¿ƒæŠ€èƒ½

${skills.map(skill => `- **${skill}**`).join('\n')}

---

## ğŸ’¼ å·¥ä½œç»éªŒ

${data.experience}

---

## ğŸ“ æ•™è‚²èƒŒæ™¯

${data.education}

---

*ç®€å†ç”± Gitvim AI ç”Ÿæˆ*
      `.trim()
    } else if (template === 'professional') {
      return `
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
              ${data.name}
          ${data.title || 'é«˜çº§å·¥ç¨‹å¸ˆ'}
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

è”ç³»æ–¹å¼
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
é‚®ç®±ï¼š${data.email}
ç”µè¯ï¼š${data.phone}
åœ°ç‚¹ï¼š${data.location}

èŒä¸šæ¦‚è¿°
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
${data.summary || 'å¯Œæœ‰ç»éªŒçš„å·¥ç¨‹å¸ˆï¼Œä¸“æ³¨äºæŠ€æœ¯åˆ›æ–°å’Œå›¢é˜Ÿåä½œã€‚'}

ä¸“ä¸šæŠ€èƒ½
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
${skills.join(' | ')}

å·¥ä½œç»å†
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
${data.experience}

æ•™è‚²èƒŒæ™¯
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
${data.education}
      `.trim()
    } else if (template === 'creative') {
      return `
âœ¦ ${data.name} âœ¦
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  ${data.title || 'åˆ›æ„å·¥ç¨‹å¸ˆ'}

ğŸ’Œ ${data.email}
ğŸ“± ${data.phone}
ğŸŒ ${data.location}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ¨ å…³äºæˆ‘
${data.summary || 'å¯Œæœ‰ç»éªŒçš„å·¥ç¨‹å¸ˆï¼Œä¸“æ³¨äºæŠ€æœ¯åˆ›æ–°å’Œå›¢é˜Ÿåä½œã€‚'}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ¨ æŠ€èƒ½æ ‘
${skills.map(skill => `â–¸ ${skill}`).join('\n')}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ’¼ ç»å†
${data.experience}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“ æ•™è‚²
${data.education}
      `.trim()
    } else {
      // Tech template
      return `
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ${data.name.padEnd(30)}â”‚
â”‚  ${data.title.padEnd(30)}â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

> CONTACT
  Email: ${data.email}
  Phone: ${data.phone}
  Location: ${data.location}

> ABOUT
  ${data.summary || 'å¯Œæœ‰ç»éªŒçš„å·¥ç¨‹å¸ˆï¼Œä¸“æ³¨äºæŠ€æœ¯åˆ›æ–°å’Œå›¢é˜Ÿåä½œã€‚'}

> SKILLS
${skills.map(skill => `  [${skill}]`).join(' ')}

> EXPERIENCE
  ${data.experience.replace(/\n/g, '\n  ')}

> EDUCATION
  ${data.education}

---
Generated by Gitvim AI
      `.trim()
    }
  }

  const handleExport = (format: 'pdf' | 'word') => {
    alert(`${format.toUpperCase()} å¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­...\n\nå½“å‰å¯ä»¥ï¼š\n1. å¤åˆ¶ç”Ÿæˆçš„ç®€å†\n2. ç²˜è´´åˆ° Word/Pages\n3. å¯¼å‡ºä¸º PDF`)
  }

  return (
    <div className="space-y-6">
      {/* æ¨¡æ¿é€‰æ‹© */}
      <div>
        <label className="block text-sm font-medium text-gray-700 mb-2">
          é€‰æ‹©ç®€å†æ¨¡æ¿
        </label>
        <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
          {templates.map((template) => (
            <button
              key={template.id}
              onClick={() => setSelectedTemplate(template.id)}
              className={`p-4 rounded-lg border-2 transition-all ${
                selectedTemplate === template.id
                  ? 'border-primary-500 bg-primary-50'
                  : 'border-gray-200 hover:border-gray-300'
              }`}
            >
              <div className={`text-2xl mb-2 text-${template.color}-500`}>
                {template.id === 'modern' && 'ğŸ“„'}
                {template.id === 'professional' && 'ğŸ“‹'}
                {template.id === 'creative' && 'ğŸ¨'}
                {template.id === 'tech' && 'ğŸ’»'}
              </div>
              <div className="text-sm font-medium">{template.name}</div>
            </button>
          ))}
        </div>
      </div>

      {/* åŸºæœ¬ä¿¡æ¯ */}
      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            å§“å *
          </label>
          <input
            type="text"
            name="name"
            value={formData.name}
            onChange={handleChange}
            className="input-field"
            placeholder="å¼ ä¸‰"
          />
        </div>
        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            èŒä½å¤´è¡”
          </label>
          <input
            type="text"
            name="title"
            value={formData.title}
            onChange={handleChange}
            className="input-field"
            placeholder="é«˜çº§ Python å·¥ç¨‹å¸ˆ"
          />
        </div>
        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            é‚®ç®±
          </label>
          <input
            type="email"
            name="email"
            value={formData.email}
            onChange={handleChange}
            className="input-field"
            placeholder="zhangsan@example.com"
          />
        </div>
        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            ç”µè¯
          </label>
          <input
            type="tel"
            name="phone"
            value={formData.phone}
            onChange={handleChange}
            className="input-field"
            placeholder="138-0000-0000"
          />
        </div>
        <div className="md:col-span-2">
          <label className="block text-sm font-medium text-gray-700 mb-2">
            æ‰€åœ¨åŸå¸‚
          </label>
          <input
            type="text"
            name="location"
            value={formData.location}
            onChange={handleChange}
            className="input-field"
            placeholder="åŒ—äº¬"
          />
        </div>
      </div>

      {/* æŠ€èƒ½ */}
      <div>
        <label className="block text-sm font-medium text-gray-700 mb-2">
          æ ¸å¿ƒæŠ€èƒ½ï¼ˆé€—å·åˆ†éš”ï¼‰
        </label>
        <input
          type="text"
          name="skills"
          value={formData.skills}
          onChange={handleChange}
          className="input-field"
          placeholder="Python, Django, PostgreSQL, Docker, å›¢é˜Ÿç®¡ç†"
        />
      </div>

      {/* ä¸ªäººç®€ä»‹ */}
      <div>
        <label className="block text-sm font-medium text-gray-700 mb-2">
          ä¸ªäººç®€ä»‹
        </label>
        <textarea
          name="summary"
          value={formData.summary}
          onChange={handleChange}
          className="input-field h-24 resize-none"
          placeholder="5å¹´Pythonå¼€å‘ç»éªŒï¼Œä¸“æ³¨äºåç«¯æ¶æ„è®¾è®¡å’Œæ€§èƒ½ä¼˜åŒ–..."
        />
      </div>

      {/* å·¥ä½œç»éªŒ */}
      <div>
        <label className="block text-sm font-medium text-gray-700 mb-2">
          å·¥ä½œç»éªŒ *
        </label>
        <textarea
          name="experience"
          value={formData.experience}
          onChange={handleChange}
          className="input-field h-40 resize-none"
          placeholder={`é«˜çº§å·¥ç¨‹å¸ˆ | ABC å…¬å¸ | 2020-è‡³ä»Š
- è´Ÿè´£æ ¸å¿ƒç³»ç»Ÿæ¶æ„è®¾è®¡ï¼Œæå‡ç³»ç»Ÿæ€§èƒ½ 40%
- å¸¦é¢† 5 äººå›¢é˜Ÿå®Œæˆå¾®æœåŠ¡æ”¹é€ 
- ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢ï¼Œå“åº”æ—¶é—´é™ä½ 60%

å·¥ç¨‹å¸ˆ | XYZ å…¬å¸ | 2018-2020
- å¼€å‘è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ï¼Œè¦†ç›–ç‡ä» 30% æå‡åˆ° 85%
- ...`}
        />
      </div>

      {/* æ•™è‚²èƒŒæ™¯ */}
      <div>
        <label className="block text-sm font-medium text-gray-700 mb-2">
          æ•™è‚²èƒŒæ™¯
        </label>
        <textarea
          name="education"
          value={formData.education}
          onChange={handleChange}
          className="input-field h-24 resize-none"
          placeholder="è®¡ç®—æœºç§‘å­¦å­¦å£« | åŒ—äº¬å¤§å­¦ | 2014-2018"
        />
      </div>

      {/* ç”ŸæˆæŒ‰é’® */}
      <div className="flex gap-4">
        <button
          onClick={handleGenerate}
          disabled={loading}
          className="btn-primary flex-1"
        >
          {loading ? 'ç”Ÿæˆä¸­...' : 'âœ¨ ç”Ÿæˆç®€å†'}
        </button>
      </div>

      {/* ç”Ÿæˆçš„ç®€å†é¢„è§ˆ */}
      {generatedResume && (
        <div className="space-y-4">
          <div className="flex items-center justify-between">
            <h3 className="font-semibold text-gray-900">ç”Ÿæˆçš„ç®€å†é¢„è§ˆ</h3>
            <div className="flex gap-2">
              <button
                onClick={() => {
                  navigator.clipboard.writeText(generatedResume)
                  alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿')
                }}
                className="px-4 py-2 text-sm bg-gray-100 hover:bg-gray-200 rounded transition-colors"
              >
                ğŸ“‹ å¤åˆ¶
              </button>
              <button
                onClick={() => handleExport('pdf')}
                className="px-4 py-2 text-sm bg-red-100 hover:bg-red-200 text-red-700 rounded transition-colors"
              >
                ğŸ“„ å¯¼å‡º PDF
              </button>
              <button
                onClick={() => handleExport('word')}
                className="px-4 py-2 text-sm bg-blue-100 hover:bg-blue-200 text-blue-700 rounded transition-colors"
              >
                ğŸ“ å¯¼å‡º Word
              </button>
            </div>
          </div>
          <div className="bg-gray-50 rounded-lg p-6 whitespace-pre-wrap font-mono text-sm max-h-[600px] overflow-y-auto border">
            {generatedResume}
          </div>
        </div>
      )}
    </div>
  )
}

export default ResumeGenerator
